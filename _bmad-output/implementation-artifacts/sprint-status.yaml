# Sprint Status Tracking
# Generated: 2026-01-03
# Project: Diagram Builder - 3D Codebase Visualization Tool

project_name: diagram_builder
sprint_start: "2025-12-29"
current_phase: "Epic 10: Not Started - 25 stories across 5 sub-epics (City Metaphor Rethink — Hierarchical Containment, Sky Edges, Atmosphere)"

# Epic and Story Status Tracking
development_status:
  # Epic 3: Parser Package (@diagram-builder/parser)
  epic-3: done
  3-1-tree-sitter-integration: done
  3-2-ast-analysis: done
  3-3-dependency-graph: done
  3-4-repository-integration: done  # Validated via Story 5.5-9, works with JS/TS repos
  3-5-ivm-conversion: done

  # Epic 4: API Package (@diagram-builder/api)
  epic-4: done
  4-1-express-server-setup: review
  4-2-jwt-authentication: review
  4-3-neo4j-integration: review
  4-4-redis-integration: review
  4-5-rest-api-parsing-endpoints: review
  4-6-rest-api-graph-query-endpoints: review
  4-7-rest-api-viewpoint-endpoints: review
  4-8-rest-api-export-endpoints: review
  4-9-rest-api-workspace-endpoints: review
  4-10-websocket-server: review
  4-11-websocket-position-updates: review
  4-12-websocket-viewpoint-events: review
  4-13-websocket-session-events: review
  4-14-codebase-import-api: done

  # Epic 5: UI Package (@diagram-builder/ui)
  epic-5: done
  epic-5-retrospective: done
  5-1-vite-react-setup: done
  5-2-feature-structure-setup: done
  5-3-error-boundary-system: done
  5-4-feature-canvas-3d: done
  5-5-feature-canvas-rendering: done
  5-6-feature-canvas-selection: done
  5-7-feature-minimap: done
  5-8-feature-navigation: done
  5-9-feature-viewpoints: done
  5-10-feature-workspace-management: done
  5-11-feature-export: done
  5-12-feature-collaboration: done
  5-13-api-client: done
  5-14-routing: done
  5-15-codebase-import-ui: done

  # Epic 5.5: Foundation Cleanup
  epic-5.5: done
  epic-5.5-retrospective: done
  5.5-1-database-seed-data: done
  5.5-2-authentication-dev-mode: done  # Dev mode auto-auth implemented, 13 tests passing
  5.5-3-e2e-test-validation: done  # Code review complete - 7 follow-ups deferred to Epic 6
  5.5-4-complete-codebase-import-api: done  # Validated via Story 5.5-9, E2E tests passing
  5.5-5-complete-codebase-import-ui: done  # Validated via Story 5.5-9, E2E tests passing
  5.5-6-documentation-reorganization: done
  5.5-7-ux-standards-cli: done
  5.5-8-sprint-status-epic-closure: done
  5.5-9-codebase-import-validation: done  # E2E tests complete, all ACs met with mitt repo
  5.5-10-fix-parser-file-discovery: done  # Resolved: Switched test repo to TypeScript (mitt), parser works correctly

  # Epic 6: Fix Parser & Complete Core Integration
  epic-6: done
  epic-6-retrospective: optional
  6-1-fix-parser-file-discovery: done  # Completed via Story 5.5-10 - parser works correctly for JS/TS repos
  6-2-add-observability-infrastructure: done  # MVP logging implemented - Winston, parser/API instrumentation, advanced features deferred
  6-3-implement-user-feedback-loading-states: done  # Empty state, parsing indicators, success/error notifications - auto-focus deferred
  6-4-end-to-end-integration-testing: done  # API integration tests (10), E2E pipeline tests (3), graph quality assertions, failure mode tests (21) - 54 total tests
  6-5-configuration-security: done  # File storage management, repo size limits, secret scanning, environment config - COMPLETE (2026-01-24)
  6-6-codebase-management-ui: done  # View codebase list with status, delete codebases, retry failed imports - COMPLETE (2026-01-24)

  # Epic 7: "Search-First Command Center" UX Implementation
  epic-7: done
  epic-7-retrospective: optional
  7-1-implement-searchbar-modal-autocomplete: done  # SearchBar with ⌘K, fuzzy autocomplete, camera flight - COMPLETE (2026-01-25)
  7-2-enhance-empty-states-loading-indicators: done  # Empty states, progress bars, toast notifications, API progress tracking - COMPLETE (2026-01-26)
  7-3-implement-camera-flight-animations: done  # Smooth camera flight with arrival feedback - COMPLETE (2026-01-26)
  7-4-add-keyboard-navigation-shortcuts: done  # Global keyboard shortcuts (⌘K, ESC, Home, C, ?, Ctrl+Shift+S) - COMPLETE (2026-01-26)
  7-5-enhance-minimap-click-to-jump: done  # MiniMap click-to-jump, FOV indicator, collapse/expand - COMPLETE (2026-01-29)
  7-6-implement-side-panels-workspace-switcher: done  # Left/right side panels with workspace switcher - COMPLETE (2026-02-01)
  7-7-enhance-hud-real-time-stats: done  # HUD with Nodes, Files, FPS, Mode stats - COMPLETE (2026-02-01)
  7-8-wcag-aa-compliance-accessibility: done  # WCAG AA compliance - semantic landmarks, ARIA labels, reduced motion, focus indicators, skip links, touch targets - COMPLETE (2026-02-01)
  7-9-implement-edge-pulse-animation: done  # Edge pulse animation on arrival - COMPLETE (2026-02-02)

  # Epic 8: City-to-Cell 3D Layout
  epic-8: done
  epic-8-retrospective: optional
  # Phase 1: Data Foundation
  8-1-add-depth-field-to-graphnode: done  # Add depth, isExternal, parentId to GraphNode type - COMPLETE (2026-02-02)
  8-2-calculate-abstraction-depth: done  # BFS algorithm from entry points - COMPLETE (2026-02-02)
  8-3-add-external-library-detection: done  # Detect and flag external library imports - COMPLETE (2026-02-02)
  8-4-add-parent-child-relationships: done  # Establish containment relationships - COMPLETE (2026-02-02)
  # Phase 2: Layout System
  8-5-create-layout-engine-interface: done  # Pluggable layout engine interface - COMPLETE (2026-02-02)
  8-6-implement-city-layout-engine: done  # City layout with building silhouettes - COMPLETE (2026-02-02)
  8-7-implement-building-layout-engine: done  # Building layout with floors - COMPLETE (2026-02-02)
  8-8-implement-cell-layout-engine: done  # Cell layout with organelles
  # Phase 3: View Modes
  8-9-create-view-mode-manager: done  # City/Building/Cell mode manager
  8-10-implement-city-view-renderer: done  # City view with building silhouettes
  8-11-implement-building-view-renderer: done  # Building view with floors and rooms
  8-12-implement-cell-view-renderer: done  # Cell view with organelles
  # Phase 4: Transitions
  8-13-implement-membrane-threshold-transition: done  # Membrane crossing effect
  8-14-implement-city-to-building-transition: done  # City-to-building camera transition - COMPLETE (2026-02-02)
  8-15-implement-building-to-cell-transition: done  # Building-to-cell camera transition - COMPLETE (2026-02-03)
  # Phase 5: Visibility Modes
  8-16-implement-xray-mode: done  # X-ray mode for see-through buildings
  8-17-implement-underground-mode: done  # Underground dependency visualization
  8-18-render-dependency-tunnels: done  # Enhanced tunnel rendering

  # Epic 9: City Visualization Overhaul — Phase 1
  epic-9: done
  # Epic 9-A: Radial City Layout & Navigation
  9-1-radial-layout-utility-functions: done  # Pure utility functions for radial position calculations - COMPLETE (2026-02-05)
  9-2-radial-city-layout-engine: done  # RadialCityLayoutEngine implementing LayoutEngine interface - COMPLETE (2026-02-05)
  9-3-district-ground-planes: done  # Colored arc-segment ground planes per district - COMPLETE (2026-02-05)
  9-4-cityview-radial-integration: done  # Wire radial engine into CityView, camera auto-fit, lodLevel fix - COMPLETE (2026-02-05)
  9-5-density-slider-store-extensions: done  # layoutDensity store state + DensitySlider UI - COMPLETE (2026-02-05)
  9-6-node-clustering-high-zoom: done  # Cluster large districts into compound buildings at city zoom - COMPLETE (2026-02-05)
  # Epic 9-B: Shape Language & Visual Differentiation
  9-7-extend-graphnode-type-union: done  # Add interface, enum, abstract_class to GraphNode.type union - COMPLETE (2026-02-06)
  9-8-building-geometry-factory: done  # Geometry factory mapping node types to Three.js configs - COMPLETE (2026-02-06)
  9-9-typed-building-components: done  # 6 typed R3F building components - COMPLETE (2026-02-06)
  9-10-cityview-type-switched-rendering: done  # Type-switched rendering in CityView - COMPLETE (2026-02-06)
  9-11-rooftop-gardens-nested-types: done  # Rooftop structures for nested types - COMPLETE (2026-02-06)
  # Epic 9-C: Signage System & Progressive Labels
  9-12-sign-selection-visibility-utilities: done  # Sign type selection and LOD visibility utilities - COMPLETE (2026-02-06)
  9-13-sign-component-library: done  # 7 R3F sign components with frustum culling - COMPLETE (2026-02-06)
  9-14-lod-calculator-hook: done  # Camera distance → lodLevel hook - COMPLETE (2026-02-06)
  9-15-sign-integration-cityview: done  # Wire signs into CityView with LOD visibility - COMPLETE (2026-02-06)
  9-16-sign-metadata-extensions: done  # Add visibility, isDeprecated, isExported to GraphNode - COMPLETE (2026-02-05)
  # Epic 9-D: Infrastructure Landmarks & Layer Control
  9-17-infrastructure-classifier: done  # Package name → infrastructure type classifier (parser) - COMPLETE (2026-02-05)
  9-18-infrastructure-landmark-components: done  # 6 R3F landmark components - COMPLETE (2026-02-05)
  9-19-infrastructure-edge-positioning: done  # Group infrastructure nodes by type at city edges - COMPLETE (2026-02-05)
  9-20-infrastructure-rendering-cityview: done  # Wire landmarks into CityView - COMPLETE (2026-02-05)
  9-21-layer-toggle-store-ui: done  # Layer toggle store + UI (above ground / underground) - COMPLETE (2026-02-05)

  # Epic 10: City Metaphor Rethink — Hierarchical Containment, Sky Edges, Atmosphere
  epic-10: in-progress
  # Epic 10-A: Structural Refactoring (Phase 0)
  10-1-cityview-interaction-test-suite: review  # Write regression test suite for CityView interactions BEFORE decomposition
  10-2-extract-shared-hooks: review  # Extract useCityLayout, useCityFiltering, useDistrictMap from CityView - COMPLETE (2026-02-11)
  10-3-decompose-cityview: not-started  # Split CityView into CityBlocks + CitySky + CityAtmosphere sub-orchestrators
  10-4-hierarchical-layout-types: not-started  # Add HierarchicalLayoutResult, BlockLayout, DistrictLayout to layout types
  10-5-extend-canvas-store-city-settings: not-started  # Add citySettings namespace (heightEncoding, transitMapMode, atmosphereOverlays, cityVersion flag)
  # Epic 10-B: Core Metaphor — Files as Land, Methods as Floors (Phase 1)
  10-6-two-phase-hierarchical-layout: not-started  # Two-phase layout: place file blocks on rings, then children within blocks
  10-7-file-block-component: not-started  # FileBlock component with subtle boundaries, merged mode for single-export files
  10-8-floor-band-rendering: not-started  # Log-scaled floor bands on class buildings with visibility coloring (vertex colors, single mesh)
  10-9-rooftop-garden-dynamic-offset: not-started  # Update RooftopGarden Y-offset to stack on top of log-scaled building height
  10-10-cityblocks-hierarchical-rendering: not-started  # Wire CityBlocks to render hierarchical layout (blocks with children inside)
  10-11-configurable-height-encoding: not-started  # Height encoding selector: methodCount, dependencies, LOC, complexity, churn
  # Epic 10-C: Sky Layer — Elevated Edges and Shadows (Phase 2)
  10-12-sky-edge-component: not-started  # Elevated bezier arc edges, type-based Y-height, color by edge type
  10-13-ground-shadow-component: not-started  # Orthographic Y=0 shadow projection for each sky edge
  10-14-remove-intra-district-edge-lines: not-started  # Replace intra-district edge lines with proximity-based layout encoding
  10-15-camera-tilt-assist: not-started  # Smooth camera pitch on node selection to reveal outgoing sky edges
  10-16-transit-map-overlay-mode: not-started  # Toggle: fade buildings (0.15 opacity), emphasize edges (full opacity, double width)
  10-17-update-citysky-orchestrator: not-started  # Wire SkyEdge + GroundShadow into CitySky, edge tier visibility controls
  # Epic 10-D: Atmosphere — Environmental Indicators (Phase 3)
  10-18-construction-crane-indicator: not-started  # Crane mesh on high-churn buildings, toggleable, data-graceful
  10-19-lighting-system-test-coverage: not-started  # Point lights for test coverage: bright=tested, dim=untested, toggleable
  10-20-smog-overlay-complexity: not-started  # Semi-transparent particle cloud over high-complexity districts, toggleable
  10-21-deprecated-indicator: not-started  # Material swap for deprecated buildings (dark, striped), toggleable
  10-22-cityatmosphere-orchestrator: not-started  # Wire all indicators into CityAtmosphere, LOD 3+ visibility
  # Epic 10-E: Configurability & UX (Phase 4)
  10-23-height-encoding-selector-ui: not-started  # Dropdown in canvas toolbar for height encoding selection
  10-24-atmosphere-toggle-panel: not-started  # Checkbox group for atmospheric indicators with disabled state
  10-25-edge-tier-visibility-controls: not-started  # Toggle switches for edge tiers + transit map mode button

# Status Definitions:
# - not-started: Story exists but work hasn't begun
# - ready-for-dev: Story validated and ready for implementation
# - in-progress: Developer actively working on story
# - review: Implementation complete, awaiting code review
# - done: Code review passed, story complete
# - blocked: Story blocked by dependency or external issue

# Epic Mapping
epics:
  epic-3:
    name: "Parser Package (@diagram-builder/parser)"
    description: "Implement Tree-sitter integration, AST analysis, dependency graph construction, repository integration, and IVM conversion for JavaScript/TypeScript codebases"
    stories:
      - 3-1-tree-sitter-integration
      - 3-2-ast-analysis
      - 3-3-dependency-graph
      - 3-4-repository-integration
      - 3-5-ivm-conversion
    dependencies:
      - "Phase 1: Project Infrastructure (Complete)"
      - "Phase 2: Core Package (Complete)"

  epic-4:
    name: "API Package (@diagram-builder/api)"
    description: "Implement Express REST API with JWT authentication, Neo4j integration, Redis caching, WebSocket server, and endpoints for parsing, graph queries, viewpoints, exports, and workspaces"
    stories:
      - 4-1-express-server-setup
      - 4-2-jwt-authentication
      - 4-3-neo4j-integration
      - 4-4-redis-integration
      - 4-5-rest-api-parsing-endpoints
      - 4-6-rest-api-graph-query-endpoints
      - 4-7-rest-api-viewpoint-endpoints
      - 4-8-rest-api-export-endpoints
      - 4-9-rest-api-workspace-endpoints
      - 4-10-websocket-server
      - 4-11-websocket-position-updates
      - 4-12-websocket-viewpoint-events
      - 4-13-websocket-session-events
      - 4-14-codebase-import-api
    dependencies:
      - "Phase 1: Project Infrastructure (Complete)"
      - "Phase 2: Core Package (Complete)"
      - "Phase 3: Parser Package (Complete)"

  epic-5:
    name: "UI Package (@diagram-builder/ui)"
    description: "Implement Vite + React 19 frontend with 3D visualization (Three.js), feature-based organization, Zustand state management, React Router, Tailwind CSS, and comprehensive component testing"
    stories:
      - 5-1-vite-react-setup
      - 5-2-feature-structure-setup
      - 5-3-error-boundary-system
      - 5-4-feature-canvas-3d
      - 5-5-feature-canvas-rendering
      - 5-6-feature-canvas-selection
      - 5-7-feature-minimap
      - 5-8-feature-navigation
      - 5-9-feature-viewpoints
      - 5-10-feature-workspace-management
      - 5-11-feature-export
      - 5-12-feature-collaboration
      - 5-13-api-client
      - 5-14-routing
      - 5-15-codebase-import-ui
    dependencies:
      - "Phase 1: Project Infrastructure (Complete)"
      - "Phase 2: Core Package (Complete)"
      - "Phase 4: API Package (In Progress - for API integration in later stories)"

  epic-5.5:
    name: "Foundation Cleanup"
    description: "Address critical foundation gaps identified in Epic 5 retrospective: authentication, e2e testing, documentation organization, database seeding, and epic closure"
    stories:
      - 5.5-1-database-seed-data
      - 5.5-2-authentication-dev-mode
      - 5.5-3-e2e-test-validation
      - 5.5-4-complete-codebase-import-api
      - 5.5-5-complete-codebase-import-ui
      - 5.5-6-documentation-reorganization
      - 5.5-7-ux-standards-cli
      - 5.5-8-sprint-status-epic-closure
      - 5.5-9-codebase-import-validation
      - 5.5-10-fix-parser-file-discovery
    dependencies:
      - "Epic 5: UI Package (14/15 stories complete)"
      - "Epic 4: API Package (13/14 stories complete)"
      - "Epic 5 Retrospective findings"

  epic-6:
    name: "Fix Parser & Complete Core Integration"
    description: "Fix the critical parser file discovery bug blocking the core feature (upload codebase → display 3D visualization), add observability infrastructure, implement user feedback and loading states, create end-to-end integration testing, address configuration and security concerns, and build codebase management UI"
    stories:
      - 6-1-fix-parser-file-discovery
      - 6-2-add-observability-infrastructure
      - 6-3-implement-user-feedback-loading-states
      - 6-4-end-to-end-integration-testing
      - 6-5-configuration-security
      - 6-6-codebase-management-ui
    dependencies:
      - "Epic 5.5: Foundation Cleanup (8/10 stories complete - Stories 5.5-9 and 5.5-10 in progress)"
      - "Brainstorming session findings (2026-01-03): Core feature broken, integration exists but parser returns 0 files"
    notes:
      - "PRIORITY: Story 6-1 is CRITICAL - fixes loadRepository() returning 0 files which blocks entire application"
      - "Epic 6 was originally planned as 'CLI Package' but brainstorming revealed core feature is broken"
      - "All downstream integration (API, Neo4j, UI) works correctly - only parser file discovery is broken"
      - "Stories 6-2 through 6-6 address gaps discovered during root cause analysis"

# Notes:
# - Phase 1 (Project Infrastructure): 100% Complete
# - Phase 2 (Core Package): 100% Complete
# - Phase 3 (Parser Package): 100% Complete
# - Phase 4 (API Package): 100% Complete
# - Phase 5 (UI Package): 100% Complete
# - Phase 5.5 (Foundation Cleanup): 80% Complete (8/10 stories done, 2 stories in-progress: 5.5-9, 5.5-10)
# - Phase 6 (Fix Parser & Complete Core Integration): PLANNED - Epic 6 redefined based on brainstorming session (2026-01-03)
#   - Original Epic 6 "CLI Package" postponed - core feature must work first
#   - Brainstorming revealed: integration layer exists and works, only parser file discovery broken
#   - 6 stories defined to fix parser, add observability, improve UX, testing, security, and management UI

  epic-7:
    name: "\"Search-First Command Center\" UX Implementation"
    description: "Transform the basic UI into the professional, data-rich experience defined in UX Design Specification: SearchBar with autocomplete, camera flight animations, keyboard shortcuts, enhanced MiniMap/HUD, side panels, and WCAG AA accessibility compliance"
    stories:
      - 7-1-implement-searchbar-modal-autocomplete
      - 7-2-enhance-empty-states-loading-indicators
      - 7-3-implement-camera-flight-animations
      - 7-4-add-keyboard-navigation-shortcuts
      - 7-5-enhance-minimap-click-to-jump
      - 7-6-implement-side-panels-workspace-switcher
      - 7-7-enhance-hud-real-time-stats
      - 7-8-wcag-aa-compliance-accessibility
      - 7-9-implement-edge-pulse-animation
    dependencies:
      - "Epic 6: Fix Parser & Complete Core Integration (4/6 stories complete)"
      - "UX Design Specification (Complete - 2026-01-24)"
    notes:
      - "Based on UX Design Specification 'Search-First Command Center' design direction"
      - "Component roadmap: Phase 1 (Core Journey), Phase 2 (Core Interaction), Phase 3 (Spatial Awareness), Phase 4 (Accessibility)"
      - "Priority: Story 7-1 (SearchBar) is CRITICAL - defines core 'Search → Fly → Understand' user journey"
      - "WCAG AA compliance required for enterprise customers (Section 508, ADA)"

  epic-8:
    name: "City-to-Cell 3D Layout"
    description: "Transform the flat 3D visualization into a multi-scale city-to-cell metaphor. Files become buildings in a city grid, classes become rooms/floors inside buildings, and methods become organelles inside biological cells. Includes view mode transitions, X-ray mode, and underground dependency visualization."
    stories:
      - 8-1-add-depth-field-to-graphnode
      - 8-2-calculate-abstraction-depth
      - 8-3-add-external-library-detection
      - 8-4-add-parent-child-relationships
      - 8-5-create-layout-engine-interface
      - 8-6-implement-city-layout-engine
      - 8-7-implement-building-layout-engine
      - 8-8-implement-cell-layout-engine
      - 8-9-create-view-mode-manager
      - 8-10-implement-city-view-renderer
      - 8-11-implement-building-view-renderer
      - 8-12-implement-cell-view-renderer
      - 8-13-implement-membrane-threshold-transition
      - 8-14-implement-city-to-building-transition
      - 8-15-implement-building-to-cell-transition
      - 8-16-implement-xray-mode
      - 8-17-implement-underground-mode
      - 8-18-render-dependency-tunnels
    dependencies:
      - "Epic 7: Search-First Command Center UX (camera flight, keyboard shortcuts)"
      - "UX 3D Layout Vision (ux-3d-layout-vision.md)"
      - "Existing parser pipeline (parser package)"
    notes:
      - "Phase 1 (Data Foundation): Stories 8-1 through 8-4 - Type extensions and parser enhancements"
      - "Phase 2 (Layout System): Stories 8-5 through 8-8 - Pluggable layout engine with city, building, cell algorithms"
      - "Phase 3 (View Modes): Stories 8-9 through 8-12 - View mode manager and three renderers"
      - "Phase 4 (Transitions): Stories 8-13 through 8-15 - Membrane effect and smooth camera transitions"
      - "Phase 5 (Visibility Modes): Stories 8-16 through 8-18 - X-ray mode, underground dependencies"
      - "Critical path: 8-1 → 8-2/8-3/8-4 → 8-5 → 8-6/8-7/8-8 → 8-9 → 8-10/8-11/8-12"

  epic-9:
    name: "City Visualization Overhaul — Phase 1"
    description: "Transform the flat grid city layout into a radial 3D visualization with visual differentiation, signage, infrastructure landmarks, and layer control. Four sub-epics: Radial Layout (9-A), Shape Language (9-B), Signage System (9-C), Infrastructure & Layers (9-D)."
    stories:
      # Epic 9-A: Radial City Layout & Navigation
      - 9-1-radial-layout-utility-functions
      - 9-2-radial-city-layout-engine
      - 9-3-district-ground-planes
      - 9-4-cityview-radial-integration
      - 9-5-density-slider-store-extensions
      - 9-6-node-clustering-high-zoom
      # Epic 9-B: Shape Language & Visual Differentiation
      - 9-7-extend-graphnode-type-union
      - 9-8-building-geometry-factory
      - 9-9-typed-building-components
      - 9-10-cityview-type-switched-rendering
      - 9-11-rooftop-gardens-nested-types
      # Epic 9-C: Signage System & Progressive Labels
      - 9-12-sign-selection-visibility-utilities
      - 9-13-sign-component-library
      - 9-14-lod-calculator-hook
      - 9-15-sign-integration-cityview
      - 9-16-sign-metadata-extensions
      # Epic 9-D: Infrastructure Landmarks & Layer Control
      - 9-17-infrastructure-classifier
      - 9-18-infrastructure-landmark-components
      - 9-19-infrastructure-edge-positioning
      - 9-20-infrastructure-rendering-cityview
      - 9-21-layer-toggle-store-ui
    dependencies:
      - "Epic 8: City-to-Cell 3D Layout (layout engine interface, view modes, underground mode)"
      - "Tech Spec: City Visualization Overhaul (tech-spec-city-visualization-overhaul.md)"
      - "Brainstorming Session (brainstorming-session-2026-02-04.md)"
    notes:
      - "4 sub-epics: 9-A (Radial Layout, 6 stories), 9-B (Shape Language, 5 stories), 9-C (Signage, 5 stories), 9-D (Infrastructure, 5 stories)"
      - "Critical path: 9-1 → 9-2 → 9-4 → 9-3/9-5/9-6 (layout foundation first)"
      - "9-B depends on 9-A (positions), 9-C depends on 9-B (buildings to attach signs), 9-D depends on 9-A (edge positioning)"
      - "Each sub-epic is standalone functional — can deliver value independently"
      - "Architect review completed — 11 items incorporated into requirements and tech spec"
      - "Phase 2 deferred: connection encoding/bundling, color system, transit-map minimap, animated flow"

  epic-10:
    name: "City Metaphor Rethink — Hierarchical Containment, Sky Edges, Atmosphere"
    description: "Complete rethink of the city visualization metaphor. Files become city blocks (land), classes become multi-story buildings with visible method floors, edges elevate into tiered sky arcs with ground shadows, and city-native atmospheric indicators show code health. Five sub-epics: Structural Refactoring (10-A), Core Metaphor (10-B), Sky Layer (10-C), Atmosphere (10-D), Configurability (10-E)."
    stories:
      # Epic 10-A: Structural Refactoring (Phase 0 — Pre-requisite)
      - 10-1-cityview-interaction-test-suite
      - 10-2-extract-shared-hooks
      - 10-3-decompose-cityview
      - 10-4-hierarchical-layout-types
      - 10-5-extend-canvas-store-city-settings
      # Epic 10-B: Core Metaphor — Files as Land, Methods as Floors (Phase 1)
      - 10-6-two-phase-hierarchical-layout
      - 10-7-file-block-component
      - 10-8-floor-band-rendering
      - 10-9-rooftop-garden-dynamic-offset
      - 10-10-cityblocks-hierarchical-rendering
      - 10-11-configurable-height-encoding
      # Epic 10-C: Sky Layer — Elevated Edges and Shadows (Phase 2)
      - 10-12-sky-edge-component
      - 10-13-ground-shadow-component
      - 10-14-remove-intra-district-edge-lines
      - 10-15-camera-tilt-assist
      - 10-16-transit-map-overlay-mode
      - 10-17-update-citysky-orchestrator
      # Epic 10-D: Atmosphere — Environmental Indicators (Phase 3)
      - 10-18-construction-crane-indicator
      - 10-19-lighting-system-test-coverage
      - 10-20-smog-overlay-complexity
      - 10-21-deprecated-indicator
      - 10-22-cityatmosphere-orchestrator
      # Epic 10-E: Configurability & UX (Phase 4)
      - 10-23-height-encoding-selector-ui
      - 10-24-atmosphere-toggle-panel
      - 10-25-edge-tier-visibility-controls
    dependencies:
      - "Epic 9: City Visualization Overhaul Phase 1 (radial layout, shape language, signage, infrastructure)"
      - "Tech Spec: City Metaphor Rethink (tech-spec-city-metaphor-rethink.md)"
    notes:
      - "5 sub-epics: 10-A (Refactoring, 5 stories), 10-B (Core Metaphor, 6 stories), 10-C (Sky Layer, 6 stories), 10-D (Atmosphere, 5 stories), 10-E (Configurability, 3 stories)"
      - "Critical path: 10-1 → 10-2 → 10-3 → 10-4/10-5 → 10-6 → 10-7/10-8/10-9 → 10-10 → 10-11"
      - "10-A MUST complete before 10-B (CityView decomposition is prerequisite)"
      - "10-B must complete before 10-C (sky edges depend on hierarchical layout)"
      - "10-D can run in parallel with 10-C (atmosphere is independent of edges)"
      - "10-E depends on 10-B/10-C/10-D (UI controls for features that must exist)"
      - "Feature flag: citySettings.cityVersion = 'v2' — current city-v1 preserved during development"
      - "No parser changes needed — all metadata already exists in graph model"
      - "Key implementation rules: single-mesh floor bands (vertex coloring), type-based edge heights, grid-based child placement"
      - "Deferred: edge bundling, LOD 4 interior view, underground layer"

